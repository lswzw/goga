!function(){"use strict";let t={key:null,token:null,expires:0};const e=window.fetch;async function n(t,e){const n=function(t){const e=window.atob(t),n=e.length,o=new Uint8Array(n);for(let t=0;t<n;t++)o[t]=e.charCodeAt(t);return o.buffer}(t),o=await window.crypto.subtle.importKey("raw",n,{name:"AES-GCM"},!1,["encrypt"]),r=(new TextEncoder).encode(e),i=window.crypto.getRandomValues(new Uint8Array(12)),a=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,r),c=new Uint8Array(i.length+a.byteLength);return c.set(i,0),c.set(new Uint8Array(a),i.length),function(t){let e="";const n=new Uint8Array(t),o=n.byteLength;for(let t=0;t<o;t++)e+=String.fromCharCode(n[t]);return window.btoa(e)}(c.buffer)}window.fetch=async function(...o){const[r,i]=o;if(i&&i.method&&"POST"===i.method.toUpperCase()&&i.body&&"string"==typeof i.body&&!r.toString().includes("/goga/api/v1/key"))try{JSON.parse(i.body);const o=i.body,{key:a,token:c}=await async function(){const n=Date.now();if(t.key&&t.token&&n<t.expires)return t;const o=await e("/goga/api/v1/key");if(!o.ok)throw t={key:null,token:null,expires:0},new Error("无法获取加密密钥。");const{key:r,token:i,ttl:a}=await o.json(),c=1e3*a*.8||24e4;return t={key:r,token:i,expires:Date.now()+c},t}(),y={token:c,encrypted:await n(a,o)},s={...i};return s.body=JSON.stringify(y),s.headers={...s.headers,"Content-Type":"application/json"},e(r,s)}catch(t){return e(...o)}return e(...o)}}();